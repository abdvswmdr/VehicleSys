<?xml version="1.0" encoding="UTF-8"?>
<mxfile host="app.diagrams.net" modified="2025-01-15T13:00:00.000Z" agent="5.0" etag="uniqueID4" version="15.0.0" type="device">
  <diagram id="NavigationStates" name="Navigation State Machine">
    <mxGraphModel dx="1400" dy="900" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1200" pageHeight="800">
      <root>
        <mxCell id="0"/>
        <mxCell id="1" parent="0"/>

        <!-- Title -->
        <mxCell id="title" value="Navigation System - State Machine" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;fontSize=18;fontStyle=1" vertex="1" parent="1">
          <mxGeometry x="400" y="20" width="400" height="30" as="geometry"/>
        </mxCell>

        <!-- Initial State -->
        <mxCell id="initial" value="" style="ellipse;fillColor=#000000;strokeColor=none;" vertex="1" parent="1">
          <mxGeometry x="585" y="80" width="30" height="30" as="geometry"/>
        </mxCell>

        <!-- Idle State -->
        <mxCell id="idle" value="IDLE" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#dae8fc;strokeColor=#6c8ebf;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="520" y="160" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="idle_desc" value="• No active navigation&#xa;• Map displays current position&#xa;• Search box visible" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="530" y="175" width="140" height="40" as="geometry"/>
        </mxCell>

        <!-- Searching State -->
        <mxCell id="searching" value="SEARCHING" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="260" y="280" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="search_desc" value="• User typing location&#xa;• GeocodeModel querying&#xa;• Results dropdown active" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="270" y="295" width="140" height="40" as="geometry"/>
        </mxCell>

        <!-- Route Planning State -->
        <mxCell id="planning" value="ROUTE_PLANNING" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="520" y="280" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="plan_desc" value="• Destination selected&#xa;• RouteModel querying OSRM&#xa;• Calculating route path" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="530" y="295" width="140" height="40" as="geometry"/>
        </mxCell>

        <!-- Route Ready State -->
        <mxCell id="route_ready" value="ROUTE_READY" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#fff2cc;strokeColor=#d6b656;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="780" y="280" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="ready_desc" value="• Route calculated&#xa;• Polyline displayed on map&#xa;• Ready to start navigation" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="790" y="295" width="140" height="40" as="geometry"/>
        </mxCell>

        <!-- Navigating State -->
        <mxCell id="navigating" value="NAVIGATING" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#d5e8d4;strokeColor=#82b366;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="520" y="400" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="nav_desc" value="• Active navigation&#xa;• Position updating (10Hz)&#xa;• Navigation panel visible&#xa;• ETA/distance updating" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="530" y="410" width="140" height="45" as="geometry"/>
        </mxCell>

        <!-- Arrival State -->
        <mxCell id="arrived" value="ARRIVED" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#e1d5e7;strokeColor=#9673a6;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="520" y="520" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="arrive_desc" value="• Destination reached&#xa;• Navigation complete&#xa;• Show arrival message" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="530" y="535" width="140" height="40" as="geometry"/>
        </mxCell>

        <!-- Error State -->
        <mxCell id="error" value="ERROR" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f8cecc;strokeColor=#b85450;fontStyle=1;fontSize=14;" vertex="1" parent="1">
          <mxGeometry x="1000" y="400" width="160" height="60" as="geometry"/>
        </mxCell>
        <mxCell id="error_desc" value="• Route calculation failed&#xa;• API error/timeout&#xa;• Invalid coordinates&#xa;• Fallback to simple route" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=top;whiteSpace=wrap;rounded=0;fontSize=10;" vertex="1" parent="1">
          <mxGeometry x="1010" y="410" width="140" height="45" as="geometry"/>
        </mxCell>

        <!-- Transitions -->

        <!-- Initial to Idle -->
        <mxCell id="trans_init" value="System Start" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;rounded=0;" edge="1" source="initial" target="idle" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Idle to Searching -->
        <mxCell id="trans_search" value="User types in search box" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;rounded=0;fontSize=11;" edge="1" source="idle" target="searching" parent="1">
          <mxGeometry x="-0.2" y="10" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- Searching back to Idle -->
        <mxCell id="trans_search_cancel" value="Clear search / No results" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#666666;rounded=0;dashed=1;fontSize=11;" edge="1" source="searching" target="idle" parent="1">
          <mxGeometry x="-0.2" y="-10" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="220" y="310"/>
              <mxPoint x="220" y="190"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Searching to Planning -->
        <mxCell id="trans_plan" value="Location selected" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;rounded=0;fontSize=11;" edge="1" source="searching" target="planning" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Idle to Planning (map tap) -->
        <mxCell id="trans_tap" value="Tap on map" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;rounded=0;fontSize=11;" edge="1" source="idle" target="planning" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Planning to Route Ready -->
        <mxCell id="trans_ready" value="routeCalculated()" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;rounded=0;fontSize=11;" edge="1" source="planning" target="route_ready" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Planning to Error -->
        <mxCell id="trans_error1" value="API error / Invalid coords" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#b85450;rounded=0;strokeWidth=2;fontSize=11;" edge="1" source="planning" target="error" parent="1">
          <mxGeometry x="0.3" y="10" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="600" y="370"/>
              <mxPoint x="1080" y="370"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Route Ready to Navigating -->
        <mxCell id="trans_start" value="startNavigation()" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;rounded=0;strokeWidth=2;fontSize=11;" edge="1" source="route_ready" target="navigating" parent="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="860" y="360"/>
              <mxPoint x="720" y="360"/>
              <mxPoint x="720" y="430"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Navigating to Arrived -->
        <mxCell id="trans_arrive" value="remainingDistance &lt; 10m" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;rounded=0;strokeWidth=2;fontSize=11;" edge="1" source="navigating" target="arrived" parent="1">
          <mxGeometry relative="1" as="geometry"/>
        </mxCell>

        <!-- Navigating self-loop -->
        <mxCell id="trans_update" value="updatePosition() [10Hz]" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#82b366;rounded=0;strokeWidth=2;fontSize=11;" edge="1" source="navigating" target="navigating" parent="1">
          <mxGeometry x="0.5" y="-20" relative="1" as="geometry">
            <mxPoint x="40" as="offset"/>
            <Array as="points">
              <mxPoint x="760" y="430"/>
              <mxPoint x="760" y="480"/>
              <mxPoint x="680" y="480"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Stop navigation -->
        <mxCell id="trans_stop" value="stopNavigation()" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#666666;rounded=0;dashed=1;fontSize=11;" edge="1" source="navigating" target="idle" parent="1">
          <mxGeometry x="-0.3" y="10" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="480" y="430"/>
              <mxPoint x="480" y="190"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Arrived to Idle -->
        <mxCell id="trans_reset" value="Auto-reset after 3s" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#000000;rounded=0;fontSize=11;" edge="1" source="arrived" target="idle" parent="1">
          <mxGeometry x="-0.5" y="10" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="460" y="550"/>
              <mxPoint x="460" y="190"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Error to Idle -->
        <mxCell id="trans_error_reset" value="Timeout / User cancel" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#666666;rounded=0;dashed=1;fontSize=11;" edge="1" source="error" target="idle" parent="1">
          <mxGeometry x="-0.6" y="10" relative="1" as="geometry">
            <mxPoint as="offset"/>
            <Array as="points">
              <mxPoint x="1080" y="190"/>
            </Array>
          </mxGeometry>
        </mxCell>

        <!-- Error to Navigating (fallback) -->
        <mxCell id="trans_fallback" value="Use simple route (fallback)" style="edgeStyle=orthogonalEdgeStyle;html=1;verticalAlign=bottom;endArrow=open;endSize=8;strokeColor=#d79b00;rounded=0;strokeWidth=2;dashed=1;fontSize=11;" edge="1" source="error" target="navigating" parent="1">
          <mxGeometry x="0.2" y="-10" relative="1" as="geometry">
            <mxPoint as="offset"/>
          </mxGeometry>
        </mxCell>

        <!-- Legend -->
        <mxCell id="legend_box" value="State Transitions" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="40" y="620" width="360" height="106" as="geometry"/>
        </mxCell>
        <mxCell id="leg1" value="Solid arrow: Normal state transition" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=9;" vertex="1" parent="legend_box">
          <mxGeometry y="26" width="360" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="leg2" value="Dashed arrow: Cancellation or error recovery" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=9;" vertex="1" parent="legend_box">
          <mxGeometry y="46" width="360" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="leg3" value="Thick arrow: Primary navigation flow" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=9;" vertex="1" parent="legend_box">
          <mxGeometry y="66" width="360" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="leg4" value="Green self-loop: Continuous update during navigation" style="text;strokeColor=none;fillColor=none;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=9;" vertex="1" parent="legend_box">
          <mxGeometry y="86" width="360" height="20" as="geometry"/>
        </mxCell>

        <!-- State Colors Legend -->
        <mxCell id="color_legend" value="State Types" style="swimlane;fontStyle=1;childLayout=stackLayout;horizontal=1;startSize=26;horizontalStack=0;resizeParent=1;resizeParentMax=0;resizeLast=0;collapsible=0;marginBottom=0;fillColor=#f5f5f5;strokeColor=#666666;fontSize=11;" vertex="1" parent="1">
          <mxGeometry x="440" y="620" width="280" height="106" as="geometry"/>
        </mxCell>
        <mxCell id="color1" value="Blue: Idle/Initial state" style="text;strokeColor=none;fillColor=#dae8fc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=9;" vertex="1" parent="color_legend">
          <mxGeometry y="26" width="280" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="color2" value="Yellow: Processing/Intermediate states" style="text;strokeColor=none;fillColor=#fff2cc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=9;" vertex="1" parent="color_legend">
          <mxGeometry y="46" width="280" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="color3" value="Green: Active navigation state" style="text;strokeColor=none;fillColor=#d5e8d4;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=9;" vertex="1" parent="color_legend">
          <mxGeometry y="66" width="280" height="20" as="geometry"/>
        </mxCell>
        <mxCell id="color4" value="Red: Error/failure state" style="text;strokeColor=none;fillColor=#f8cecc;align=left;verticalAlign=top;spacingLeft=4;spacingRight=4;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=9;" vertex="1" parent="color_legend">
          <mxGeometry y="86" width="280" height="20" as="geometry"/>
        </mxCell>

        <!-- Notes -->
        <mxCell id="notes_box" value="Update Rates&#xa;• Position: 100ms (10Hz)&#xa;• Navigation Data: 1s (1Hz)&#xa;• Route Calculation: On-demand&#xa;&#xa;Key Signals&#xa;• routeCalculated()&#xa;• arrivalReached()&#xa;• currentPositionChanged()" style="rounded=1;whiteSpace=wrap;html=1;fillColor=#f5f5f5;strokeColor=#666666;align=left;fontSize=10;verticalAlign=top;" vertex="1" parent="1">
          <mxGeometry x="760" y="620" width="400" height="106" as="geometry"/>
        </mxCell>

      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
